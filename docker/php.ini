[PHP]

; PHP Configuration for h5ai
; Optimized for Docker container with Apache + PHP-FPM

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
; Error handling and logging ;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

; This directive controls whether or not and where PHP will output errors,
; notices and warnings too. Error output is very useful during development,
; but it could be very dangerous in production environments.
; For production environment: error_reporting = E_ALL & ~E_DEPRECATED & ~E_STRICT
error_reporting = E_ALL & ~E_DEPRECATED & ~E_STRICT

; Print out errors (as a part of the output).  For production web sites,
; you're strongly encouraged to turn this feature off, and use error logging
; instead (see below).  Keeping display_errors enabled on a production web site
; may reveal security information to end users, such as file paths on your Web
; server, your database schema or other information.
display_errors = On

; Log errors into a file (server-specific log, stderr, or error_log (below))
; As stated above, you're strongly advised to use error logging in place of
; error displaying on production web sites.
log_errors = On

; The name of the file where script errors should be logged.
error_log = /var/log/php8/error.log

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
; Resource Limits ;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

; Maximum execution time of each script, in seconds
max_execution_time = 300

; Maximum amount of time each script may spend parsing request data
max_input_time = 300

; Maximum amount of memory a script may consume
memory_limit = 256M

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
; File Uploads ;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

; Whether to allow HTTP file uploads.
file_uploads = On

; Maximum allowed size for uploaded files.
upload_max_filesize = 100M

; Maximum size of POST data that PHP will accept.
post_max_size = 100M

; Maximum number of files that can be uploaded via a single request
max_file_uploads = 20

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
; Fopen wrappers ;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

; Whether to allow the treatment of URLs (like http:// or ftp://) as files.
allow_url_fopen = On

; Whether to allow include/require to open URLs (like http:// or ftp://) as files.
allow_url_include = Off

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
; Miscellaneous ;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

; Decides whether PHP may expose the fact that it is installed on the server
; (e.g. by adding its signature to the Web server header).  It is no security
; threat in any way, but it makes it possible to determine whether you use PHP
; on your server or not.
expose_php = Off

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
; Data Handling ;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

; Maximum input nesting level
max_input_nesting_level = 64

; Maximum input variables
max_input_vars = 3000

; Time zone
date.timezone = UTC

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
; Session ;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

; Handler used to store/retrieve data.
session.save_handler = files

; Argument passed to save_handler.  In the case of files, this is the path
; where data files are stored.
session.save_path = "/tmp"

; Lifetime in seconds of cookie or, if 0, until browser is restarted.
session.cookie_lifetime = 0

; The path for which the cookie is valid.
session.cookie_path = /

; Domain for which the cookie is valid.
session.cookie_domain =

; Whether or not to add the strict option to the cookie.
session.cookie_httponly = On

; Whether or not to add the secure flag to the cookie.
session.cookie_secure = Off

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
; OPcache ;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

; Enable OPcache for performance improvement
opcache.enable=1

; Enable OPcache for the CLI version of PHP
opcache.enable_cli=0

; The OPcache shared memory storage size.
opcache.memory_consumption=128

; The amount of memory for interned strings in MB.
opcache.interned_strings_buffer=8

; The maximum number of keys (scripts) in the OPcache hash table.
opcache.max_accelerated_files=4000

; How often (in seconds) to check file timestamps for changes to the shared
; memory storage allocation.
opcache.revalidate_freq=2

; If enabled, a fast shutdown sequence is used for the accelerated code.
opcache.fast_shutdown=1

; Validate file timestamps.
opcache.validate_timestamps=1

; If disabled, all PHPDoc comments are dropped from the code to reduce the size
; of the optimized code.
opcache.save_comments=1

; Allow file existence checks (file_exists(), is_file() and is_dir()) to be
; cached.
opcache.enable_file_override=0

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
; Security ;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

; Disable_functions for security
disable_functions = passthru,shell_exec,system,proc_open,popen

; Open basedir (comment out if not needed)
;open_basedir = /var/www/html/:/tmp/

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
; h5ai Specific ;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

; GD extension settings for thumbnails
gd.jpeg_ignore_warning = 1

; EXIF extension for image metadata
exif.encode_unicode = UTF-8
exif.decode_unicode_motorola = UCS-2BE
exif.decode_unicode_intel = UCS-2LE

; MBString extension
mbstring.language = Neutral
mbstring.internal_encoding = UTF-8
mbstring.http_input = auto
mbstring.http_output = UTF-8
mbstring.encoding_translation = Off
mbstring.func_overload = 0
mbstring.strict_detection = Off

; Zip extension settings
zip.temp_dir = /tmp